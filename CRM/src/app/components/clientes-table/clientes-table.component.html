<h2 class="mb-4 fw-light">Listado de Clientes</h2>

<div class="filtros card p-3 mb-4 border-0 shadow-sm bg-white">
  <div class="d-flex gap-3 align-items-end flex-wrap">
    <label class="flex-grow-1">
      Nombre
      <input
        type="text"
        class="form-control mt-1"
        [(ngModel)]="filtroNombre"
        (input)="onFiltrar()"
        placeholder="Buscar por nombre...">
    </label>

    <label class="flex-grow-1">
      CIF
      <input
        type="text"
        class="form-control mt-1"
        [(ngModel)]="filtroCif"
        (input)="onFiltrar()"
        placeholder="Buscar por CIF...">
    </label>

    <button class="btn btn-outline-secondary" (click)="onLimpiarFiltros()">
      <i class="bi bi-x-circle"></i> Limpiar
    </button>
  </div>
</div>

<div *ngIf="cargando" class="text-center p-4 text-muted">
  <div class="spinner-border text-primary" role="status"></div>
  <p class="mt-2">Cargando datos...</p>
</div>

<div *ngIf="error" class="alert alert-danger">{{ error }}</div>

<div class="table-responsive" *ngIf="!cargando && clientes.length > 0">
  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>CIF</th>
        <th>Dirección</th>
        <th>Email</th>
        <th>Teléfono</th>
        <th class="text-center">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let c of clientes">
        <td><span class="badge bg-light text-dark border">{{ c.id }}</span></td>
        <td class="fw-bold">{{ c.nombre }}</td>
        <td>{{ c.cif }}</td>
        <td class="text-muted small">{{ c.direccion }}</td>
        <td><a href="mailto:{{ c.email }}" class="text-decoration-none">{{ c.email }}</a></td>
        <td>{{ c.telefono }}</td>
        <td class="text-center">
          <button class="btn btn-sm btn-primary shadow-sm px-3" (click)="abrirFormularioContacto(c)">
            + Contacto
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div *ngIf="!cargando && clientes.length === 0" class="alert alert-warning text-center">
  No se encontraron clientes con esos filtros.
</div>

@if (clienteSeleccionadoId) {
  <div class="modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        
        <div class="modal-header">
          <h5 class="modal-title">Añadir Contacto</h5>
          <button type="button" class="btn-close" (click)="cerrarFormulario()"></button>
        </div>
        
        <div class="modal-body">
          <app-contacto-form 
            [clienteId]="clienteSeleccionadoId"
            (onSave)="onContactoGuardado()"
            (onCancel)="cerrarFormulario()">
          </app-contacto-form>
        </div>

      </div>
    </div>
  </div>
}